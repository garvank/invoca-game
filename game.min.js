/* ----------------- *
 * The Game          *
 * Updated: 07/03/15 *
 * ----------------- */

function keyboard(a){var b={};return b.code=a,b.isDown=!1,b.isUp=!0,b.press=void 0,b.release=void 0,b.downHandler=function(a){a.keyCode===b.code&&(b.isUp&&b.press&&b.press(),b.isDown=!0,b.isUp=!1),a.preventDefault()},b.upHandler=function(a){a.keyCode===b.code&&(b.isDown&&b.release&&b.release(),b.isDown=!1,b.isUp=!0),a.preventDefault()},window.addEventListener("keydown",b.downHandler.bind(b),!1),window.addEventListener("keyup",b.upHandler.bind(b),!1),b}function keyBindings(){var a=keyboard(37),b=(keyboard(38),keyboard(39)),c=(keyboard(40),keyboard(32)),d=keyboard(13);c.press=function(){game.callSpeed=2,setTimeout(function(){game.moveSpeed=2},1e4)},c.release=function(){game.moveSpeed=15,game.callSpeed=7},d.press=function(){game.paused&&playAgain()},a.press=function(){invoca.vx=-game.moveSpeed,invoca.vy=0},a.release=function(){b.isDown||0!==invoca.vy||(invoca.vx=0)},b.press=function(){invoca.vx=game.moveSpeed,invoca.vy=0},b.release=function(){a.isDown||0!==invoca.vy||(invoca.vx=0)}}function randInt(a,b){var c=b-a,d=Math.floor(Math.random()*(c+1));return a+d}function didCollide(a,b){return!(b.x>a.x+a.width||b.x+b.width<a.x||b.y>a.y+a.height||b.y+b.height<a.y)}function clearAll(){for(var a=stage.children.length-1;a>=0;a--)stage.removeChild(stage.children[a])}function updateScore(){game.score++,theScore.text="Score: "+game.score,game.difficulty>=250&&(game.difficulty-=10)}function initLives(){for(var a=PIXI.Texture.fromImage("img/heart.png"),b=game.livesLeft;b>=1;b--)lives["life"+b]=new PIXI.Sprite(a),lives["life"+b].height=15,lives["life"+b].width=15,lives["life"+b].x=game.stage.width-(lives["life"+b].height+2)*b,lives["life"+b].y=game.stage.height-lives["life"+b].height,stage.addChild(lives["life"+b])}function livesLeft(a){function b(){var a=game.livesLeft+1;0!==a&&stage.removeChild(lives["life"+a])}game.livesLeft+a<game.totalLives&&(game.livesLeft+=a),game.livesLeft>0?b():state=gameOver}function gameLoop(){game.paused||(requestAnimationFrame(gameLoop),state(),renderer.render(stage))}function play(){moveCharacter(),makeCall(),game.score%50===0&&makeHeart()}function gameOver(){clearAll(),console.log("Score was: "+game.score),game.highScore<game.score&&(game.highScore=game.score,setCookie("gameHighScore",game.highScore,365));var a=new PIXI.Text("Game Over\nYour score was: "+game.score+"\n\nHigh Score: "+game.highScore,{font:"25px Arial",fill:"white"});a.x=game.stage.width/2-a.width/2,a.y=game.stage.height/2-a.height;var b=new PIXI.Text("Press enter to play again!",{font:"15px Arial",fill:"white"});b.x=game.stage.width/2-b.width/2,b.y=a.y+200,stage.addChild(a),stage.addChild(b),game.paused=!0}function init(){var a=readCookie("gameHighScore")||0;window.game={stage:{height:600,width:350},highScore:a,score:0,difficulty:600,callReady:!0,callSpeed:5,paused:!1,moveSpeed:15,totalLives:3,livesLeft:3,heartReady:!0},window.renderer=new PIXI.autoDetectRenderer(game.stage.width,game.stage.height),document.body.appendChild(renderer.view),window.playAgain=function(){game.score=0,game.paused=!1,game.livesLeft=game.totalLives,clearAll(),setup()},window.stage=new PIXI.Container,setup()}function setup(){var a=PIXI.Texture.fromImage("img/invoca.png");window.invoca=new PIXI.Sprite(a),invoca.height=50,invoca.width=50,invoca.x=game.stage.width/2-invoca.width/2,invoca.y=game.stage.height-invoca.height-15,invoca.vx=0,invoca.vy=0,stage.addChild(invoca),keyBindings(),window.state=play,window.theScore=new PIXI.Text("Score: "+game.score,{font:"15px Arial",fill:"white"}),theScore.x=game.stage.width/2-theScore.width/2,theScore.y=game.stage.height-15,stage.addChild(theScore),window.lives={},initLives(),gameLoop()}function makeCall(){function a(){didCollide(d,invoca)?(updateScore(),stage.removeChild(d)):d.y<=game.stage.height+d.height?(d.y+=d.vy,requestAnimationFrame(a)):livesLeft(-1)}function b(){var a=randInt(250,game.difficulty);setTimeout(function(){game.callReady=!0},a)}if(game.callReady){game.callReady=!1;var c=PIXI.Texture.fromImage("img/phones/phone-icon.png"),d=new PIXI.Sprite(c);d.height=50,d.width=50,d.x=randInt(0,game.stage.width-d.width),d.y=0-d.height,d.vx=0,d.vy=game.callSpeed,stage.addChild(d),b(),requestAnimationFrame(a)}}function makeHeart(){function a(){didCollide(c,invoca)?(livesLeft(1),stage.removeChild(c),game.heartReady=!0):c.y<=game.stage.height+c.height?(c.y+=c.vy,requestAnimationFrame(a)):game.heartReady=!0}if(game.heartReady){game.heartReady=!1;var b=PIXI.Texture.fromImage("img/heart.png"),c=new PIXI.Sprite(b);c.height=50,c.width=50,c.x=randInt(0,game.stage.width-c.width),c.y=0-c.height,c.vx=0,c.vy=game.callSpeed,stage.addChild(c)}requestAnimationFrame(a)}function moveCharacter(){diffX=invoca.x+invoca.vx,diffY=invoca.y+invoca.vy,invoca.x=diffX<=game.stage.width-invoca.width&&diffX>=0?diffX:invoca.x,invoca.y=diffY<=game.stage.height-invoca.height&&diffY>=0?diffY:invoca.y}setCookie=function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString(),f="path=/",g=document.domain.split("."),h=g.length-2,i="domain=."+g[h]+"."+g[h+1];document.cookie=a+"="+b+"; "+e+"; "+f+"; "+i},readCookie=function(a){return(document.cookie.match("(^|; )"+a+"=([^;]*)")||0)[2]||null};